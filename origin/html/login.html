<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>京东-欢迎登陆</title>
    <link rel="stylesheet" href="../resource/css/Common.css">
    <link rel="stylesheet" href="../font/iconfont/iconfont.css">
    <link rel="stylesheet" href="../resource/css/login.css">
    <link rel="stylesheet" href="../resource/css/footerCommon.css">
</head>
<body>
    <!-- 头部 -->
    <header>
        <div class="container">
            <div class="logo">
                <a href="#">
                    <img src="../resource/images/login/logo.png" alt="">
                </a>
                <i class="welcome"></i>
            </div>
            <div class="survey">
                <i class="iconfont surveyIcon">&#xe612</i>
                <a href="#">登录页面，调查问卷</a>
            </div>
        </div>
    </header>

    <!-- 中间 -->
    <main>
        <!-- 提示信息 -->
        <div class="container">
            <div class="content">
                <div class="tipsWrapper">
                    <div class="tipsInner">
                        <div class="contentWrapper">
                            <i class="iconfont tipsIcon">&#xe78a</i>
                            <span>
                                依据《网络安全法》，为保证您的账户安全和正常使用，请尽快完成手机号验证！新版<a href="#">《京东隐私政策》</a>已上线，将更有利于保护您的个人隐私。
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- 中部背景和登录界面 -->
        <div class="login">
            <div class="container">
                <div class="loginForm">
                    <div class="tipsWrapper">
                        <div class="tipsInner">
                            <div class="contentWrapper">
                                <i class="iconfont tipsIcon">&#xe78a</i>
                                <span>
                                    京东不会以任何理由要求您转账汇款，谨防诈骗。
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="loginTab scanCodeLoginTab">
                        <a href="#">扫码登录</a>
                    </div>
                    <div class="loginTab accountLoginTab">
                        <a href="#">账户登录</a>
                    </div>
                    <div class="loginBox">
                        <div class="codeH"></div>
                        <div class="msgWrap">
                            <div class="msgErr">
                                <i ></i>
                            </div>
                        </div>
                        <!-- 账户登录 -->
                        <div class="accountLogin">
                            <div class="accountLoginForm">
                                <form action="" id="loginFrom" method="POST">
                                    <div class="formCom usernameTab">
                                        <label for="loginname" class="loginNameLabel"></label>
                                        <input type="text" id="username" class="username" value placeholder="邮箱/用户名/登录手机">
                                    </div>
                                    <div class="formCom passwordTab">
                                        <label for="loginpassword" class="loginPswLabel"></label>
                                        <input type="text" id="password" class="password" value placeholder="密码">
                                    </div>
                                    <!-- 忘记密码 -->
                                    <div class="formCom forgetPsw">
                                        <div class="safe">
                                            <span></span>
                                            <span class="forgetPswSafe">
                                                <a href="#">忘记密码</a>
                                            </span>
                                        </div>
                                    </div>
                                    <!-- 登录按钮 -->
                                    <div class="formCom loginBtnTab">
                                        <div id="loginBtn" class="loginBtn">
                                            登&nbsp;&nbsp;&nbsp;&nbsp;录
                                        </div>
                                    </div>
                                    <!-- 其他登录方式 -->
                                    <div class="otherLoginWay">
                                        <ul>
                                            <li class="fl">
                                                <a href="#">
                                                    <i class="fl qqImg"></i>
                                                    <span>QQ</span>
                                                </a>
                                            </li>
                                            <li class="fl space"></li>
                                            <li class="fl">
                                                <a href="#">
                                                    <i class="fl wxImg"></i>
                                                    <span>微信</span>
                                                </a>
                                            </li>
                                            <li class="fr">
                                                <div class="nowRegister">
                                                    <a href="../html/register.html">
                                                        <i class="fl"></i>
                                                        <span>立即注册</span>
                                                    </a>
                                                </div>
                                            </li>
                                        </ul>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- 登录背景 -->
            <div class="loginBg">
                <div class="container">
                    <div class="loginBgImg"></div>
                </div>
            </div>
        </div>
    </main>

    <!-- 底部 -->
    <footer>
        <div class="container">
            <div class="footerBox">
                <div class="linkBox">
                    <a href="../index.html">关于我们</a>
                    <span class="line">|</span>
                    <a href="../index.html">联系我们</a>
                    <span class="line">|</span>
                    <a href="#">人才招聘</a>
                    <span class="line">|</span>
                    <a href="#">商家入驻</a>
                    <span class="line">|</span>
                    <a href="#">广告服务</a>
                    <span class="line">|</span>
                    <a href="#">手机京东</a>
                    <span class="line">|</span>
                    <a href="#">友情链接</a>
                    <span class="line">|</span>
                    <a href="#">销售联盟</a>
                    <span class="line">|</span>
                    <a href="#">京东社区</a>
                    <span class="line">|</span>
                    <a href="#">京东公益</a>
                    <span class="line">|</span>
                    <a href="#">English Site</a>
                </div>
                <div class="copyrigthtBox">
                    Copyright&nbsp;&nbsp;&copy;2004-2020&nbsp;&nbsp;京东JD.com&nbsp;版权所有
                </div>
            </div>
        </div>
    </footer>

    <script src="../js/request.js"></script>

    <script>
        ;(function(){
            // 实现用户名验证功能
            var username=document.getElementById("username");
            var password=document.getElementById("password");
            var loginBtn=document.getElementById("loginBtn");
            // 定义两把锁，一把决定用户名是否验证通过，一把决定密码是否验证通过
            // 只有当用户名正确时才允许提交，密码在这里一般不验证
            var user_lock=false;
            var pass_lock=false;

            username.onblur=function(){
              // 获取用户输入的文本
              var val=username.value;
              // 定义正则表达式
              var reg=/^\d{11}$/;
              // 验证是否符合正则的规则
              if(!reg.test(val)){
                // 可以设置其他样式表示输入错误
                // alert("用户名格式为6~10个字母和数字的组合（不能以数字开头）");
                username.style.color="rgb(252, 49, 49)";
                username.value="请输入正确的手机号！";
                setTimeout(function(){
                    username.style.color="#666";
                    // 防止用户第一次输入错误后点掉alert直接提交的行为
                    user_lock=false;
                    username.value=val;
                },500);
                return;
                } 
                // 检查用户名是否已存在
                request.pPost("../php/checkUsername.php",{username:val})
                .then(function (data) {
                    if (!data.error) {
                        console.log(data.msg);
                        user_lock = true;
                    } else {
                        throw new Error(data.msg);
                    }
                })
                .catch(function (err) {
                    alert(err);
                    user_lock = false;
                });
                user_lock=true;
            }

            password.onblur=function(){
              var val=password.value;
              var reg=/^\w{6,10}$/;
              if(!reg.test(val)){
                password.style.color="rgb(252, 49, 49)";
                  password.value="6~10位数字和字母！";
                    setTimeout(function(){
                        password.style.color="#666";
                        // 防止用户第一次输入错误后点掉alert直接提交的行为
                        pass_lock=false;
                        password.value=val;
                    },500);
                return;
              }
              // 检查用户名是否已存在
              request.pPost("../php/checkPassword.php",{password:val})
                .then(function (data) {
                    if (!data.error) {
                        console.log(data.msg);
                        pass_lock = true;
                    } else {
                        throw new Error(data.msg);
                    }
                })
                .catch(function (err) {
                    alert(err);
                    pass_lock = false;
                });
                pass_lock=true;
            }

            loginBtn.onclick=function(){
                // 验证两把锁
                if(!(user_lock&&pass_lock)){
                    return;
                }
                // 如果通过了就发送请求
                request.pPost("../php/login.php",{username:username.value,password:password.value})
                .then(function(data){
                  if(!data.error){
                      // 提示用户
                      alert(data.msg);
                      // 登录成功，跳转到列表页
                      location.href="./list.html";
                    }else{
                        throw new Error(data.msg);
                    }
                })
                .catch(function(e){
                    console.log("请求错误！");
                });
            }
        })();
    </script>
</body>
</html>